{% extends 'base.html' %}
{% block chart %}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var djangoData = "{{ chart_data }}";
        console.log(djangoData)
        var djangoData = djangoData.replace(/&#39;/g,'"');
        var djangoData = JSON.parse(djangoData);
        var data = google.visualization.arrayToDataTable(djangoData);

        var options = {
          title: 'Ependiture by expense type',
          is3D: true,
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
      }
    </script>
{% endblock %}
{% block content %}

<div class="display-4 mb-4">
    Expense types:
</div>

<table class="table">
    <thead>
    <tr>
        <th>Name</th>
        <th>Active</th>
        <th>Delete</th>
    </tr>
    </thead>
    {% for type in expense_types %}
    <tr>
        <td>
            <a href="{% url 'edit_type' keeper.id type.id %}">{{type.tipas}}
            </a>
        </td>
        <td>
            <a href="{% url 'edit_type' keeper.id type.id %}">
                {{type.aktyvus}}
            </a>

        </td>
        {% if type %}
        <td>
            <a style="text-decoration: none" href="{% url 'delete_type' keeper.id type.id %}">Delete</a>
        </td>
        {% endif %}
    </tr>
    {% endfor %}
</table>

<button class="btn btn-dark mb-5">
    <a style="color: inherit; text-decoration:none;" href="{% url 'create_type' keeper.id %}">Create New</a>
</button>

<div class="display-4 mb-4">
    Expenses:
</div>

<table class="table">
    <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Description</th>
        <th>Supplier</th>
        <th>Doc No</th>
        <th>Amount</th>
        <th>Delete</th>
    </tr>
    {% for expense in expenses %}
    <tr>
        <td>
            <a href="{% url 'delete_expense' keeper.id expense.id %}">{{expense.data|date:"Y m d"}}
            </a>
        </td>
        <td>
            <a href="{% url 'edit_expense' keeper.id expense.id %}">{{expense.tipas}}
            </a>
        </td>
        <td>
            <a href="{% url 'edit_expense' keeper.id expense.id %}">{{expense.description}}
            </a>
        </td>
        <td>
            <a href="{% url 'edit_expense' keeper.id expense.id %}">{{expense.tiekejas}}
            </a>
        </td>
        <td>
            <a href="{% url 'edit_expense' keeper.id expense.id %}">{{expense.dok_nr}}
            </a>
        </td>
        <td>
            <a href="{% url 'edit_expense' keeper.id expense.id %}">{{expense.suma}}
            </a>
        </td>
        <td>
            {% if expense %}
            <a href="{% url 'delete_expense' keeper.id expense.id %}">Delete
            </a>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
    <tr>
        <td class="font-weight-bold">Total</td>
        <td></td>
        <td></td>
        <td></td>
        <td class="font-weight-bold">{{expenses_total|floatformat:2}}</td>
    </tr>

</table>
<button class="btn btn-dark mb-5">
    <a style="color: inherit; text-decoration:none;" href="{% url 'create_expense' keeper.id %}">Create New</a>
</button>

<div class="mx-auto" id="piechart" style="width: 900px; height: 500px;"></div>

{% endblock %}